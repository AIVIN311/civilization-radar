# Civilization Radar v0.5（PR-2 進行中）

中文版快速說明。英文完整版請看 `README.md`。
v0.4 為穩定底座；v0.5 PR-2 只新增 geo 資料層，不改 v0.4 核心分數語意。

## v0.4 重點

- 快照輸入先 normalize，固定 schema，並記錄缺欄位/多欄位。
- series alias 單一來源：`config/series_aliases.json`。
- 事件強度有 explain payload，寫入 `events_v01.strength_explain_json`。
- chain 推力拆成 `base_score / boosted_score / delta_boost`。
- edge 帶 `src_event_*` 說明欄位，可追溯事件來源。
- `half_life_days` 可由 CLI 或 ENV 調整。
- `eval_quality` 變成 hard gate（critical 直接 non-zero）。
- 生成物使用穩定結構，最新成功輸出固定在 `output/latest/`。

## v0.5 PR-2（Geo Factor 資料層）

- SSOT 路徑固定：`config/geo_profiles_v1.json`。
- 每次 run 單一 active profile：`--geo-profile`（預設 `tw`）。
- 鏈式輸出新增欄位（不改 v0.4 base/boosted/delta）：
  - `geo_factor`
  - `geo_factor_explain_json`
  - `tw_rank_score`
  - `tw_rank_explain_json`

## 完整流程

```bash
python run_pipeline_50.py --output-dir output --half-life-days 7 --geo-profile tw --input-snapshots input/snapshots.jsonl
```

輸出：

- `output/latest/radar.db`
- `output/latest/dashboard_v04.html`
- `output/reports/eval_quality_<run_id>.json`

## 一鍵執行

`run_pipeline_50.py` 會把每次完整輸出寫到：

- `output/runs/<YYYYMMDDTHHMMSSZ>/`
- 成功後 promote 到 `output/latest/`

## 固定回歸驗收

- 固定樣本：`input/snapshots.sample.jsonl`
- 驗收腳本：`python scripts/run_acceptance_v04.py`
- latest 包裝器：`python scripts/run_acceptance_latest.py`

驗收腳本會驗證 deterministic hash、alias 收斂、cf/origin 強度差、Top-3 explain、half-life 敏感度、L3 一致性、與 gate 失敗條件。

輸出清理：

- `python scripts/clean_output.py`
- `python scripts/clean_output.py --nuke`
# Weekly Rhythm

Monday
- Snapshot collection (automatic)

Friday
- Promote latest acceptance to output/latest

End of Month
- Full pipeline run
- Release tag
- Archive outputs
