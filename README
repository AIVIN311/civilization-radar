# Civilization Radar v0.4

中文版快速說明。英文完整版請看 `README.md`。

## v0.4 重點

- 快照輸入先 normalize，固定 schema，並記錄缺欄位/多欄位。
- series alias 單一來源：`config/series_aliases.json`。
- 事件強度有 explain payload，寫入 `events_v01.strength_explain_json`。
- chain 推力拆成 `base_score / boosted_score / delta_boost`。
- edge 帶 `src_event_*` 說明欄位，可追溯事件來源。
- `half_life_days` 可由 CLI 或 ENV 調整。
- `eval_quality` 變成 hard gate（critical 直接 non-zero）。
- 生成物統一在 `output/`。

## 完整流程

```bash
python scripts/apply_sql_migrations.py --output-dir output
python seed_from_snapshots.py --input input/snapshots.jsonl --output-dir output
python upgrade_to_v02.py --output-dir output
python scripts/derive_events_from_daily.py --input output/daily_snapshots.jsonl --output-dir output
python scripts/load_events_into_db.py --output-dir output
python build_chain_matrix_v10.py --half-life-days 7 --output-dir output
python upgrade_to_v03_chain.py --output-dir output
python render_dashboard_v02.py --half-life-days 7 --output-dir output
python scripts/eval_quality.py --missing-ratio-threshold 0.0 --output-dir output
```

輸出：

- `output/radar.db`
- `output/dashboard_v04.html`
- `output/reports/eval_quality.json`

## 一鍵執行

```bash
python run_pipeline_50.py --output-dir output --half-life-days 7 --input-snapshots input/snapshots.jsonl
```

## 固定回歸驗收

- 固定樣本：`input/snapshots.sample.jsonl`
- 驗收腳本：`python scripts/run_acceptance_v04.py`

驗收腳本會驗證 deterministic hash、alias 收斂、cf/origin 強度差、Top-3 explain、half-life 敏感度、L3 一致性、與 gate 失敗條件。
